ALTER TABLE `M_DAY_POINT_DETAIL`
ADD COLUMN `MY_MONEY`  int(11) NULL DEFAULT 0 COMMENT '个人业绩' AFTER `VERSION`,
ADD COLUMN `TEAM_MONEY`  int(11) NULL DEFAULT 0 COMMENT '团队业绩' AFTER `MY_MONEY`;





CREATE TABLE `M_DAY_REPORT` (
  `ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '编号',
  `COLLECT_DATE` date DEFAULT NULL COMMENT '统计日期',
  `REWARD_AMOUNT` decimal(12,2) DEFAULT NULL COMMENT '直推奖励',
  `BEANS_NUM` int(11) DEFAULT NULL COMMENT '购物积分（博豆）',
  `POINT_AMOUNT` decimal(12,2) DEFAULT NULL COMMENT '推广积分',
  `MANAGE_AMOUNT` decimal(12,2) DEFAULT NULL COMMENT '管理奖励',
  `COACH_AMOUNT` decimal(12,2) DEFAULT NULL COMMENT '辅导奖励',
  `VIP_NUM` int(11) DEFAULT NULL COMMENT '激活会员人数',
  `RECHARGE_AMOUNT` decimal(12,2) DEFAULT NULL COMMENT '充值金额',
  `RECHARGE_BEANS` int(11) DEFAULT NULL COMMENT '充值博豆',
  `RECHARGE_POINT` int(11) DEFAULT NULL COMMENT '充值积分',
  `DRAW_REQ` decimal(12,2) DEFAULT NULL COMMENT '提现申请',
  `DRAW_AMOUNT` decimal(12,2) DEFAULT NULL COMMENT '提现金额',
  `EXCHANGE_NUM` int(11) DEFAULT NULL COMMENT '云碟兑换数量',
  `SEND_NUM` int(11) DEFAULT NULL COMMENT '发货数量',
  `HLG_NUM` int(11) DEFAULT NULL COMMENT '韩流馆消费会员数量',
  `HLG_AMOUNT` decimal(11,0) DEFAULT NULL COMMENT '韩流馆消费的现金',
  `HLG_BEANS` int(11) DEFAULT NULL COMMENT '韩流馆消费积分',
  `ACT_USER_AMOUNT` decimal(12,0) DEFAULT NULL COMMENT '激活用户消费的现金',
  `ACT_USER_BEANS` int(11) DEFAULT NULL COMMENT '激活用户消费的博豆',
  `ACT_USER_POINT` int(11) DEFAULT NULL COMMENT '激活用户消费的积分',
  `VERSION` int(11) DEFAULT NULL COMMENT '乐观锁',
  PRIMARY KEY (`ID`),
  UNIQUE KEY `inx_day_report` (`COLLECT_DATE`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8 COMMENT='会员日报表';



ALTER TABLE `M_USER_REG`
ADD COLUMN `REG_NUM`  int(10) NULL  DEFAULT 1   COMMENT '单数' AFTER `CREATE_TIME`;



CREATE TABLE `M_DRAW_CASH_LOG` (
  `ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `USER_ID` int(11) NOT NULL COMMENT '用户id',
  `CASH_ID` varchar(50) NOT NULL COMMENT '提现id',
  `ORDER_ID` int(11) NOT NULL COMMENT '订单id（提现表主键）',
  `AMOUNT` int(11) NOT NULL COMMENT '提现金额',
  `STATUS` int(4) NOT NULL COMMENT '状态(0.已发送请求 1.发送成功 2.发送失败 3.提现成功4.提现失败)',
  `CREATE_TIME` datetime NOT NULL COMMENT '创建时间',
  `UPDATE_TIME` datetime NOT NULL COMMENT '修改时间',
  `IS_DELETED` int(4) NOT NULL DEFAULT '0' COMMENT '是否删除，0是删除，1是存在',
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8 COMMENT='提现记录表';



CREATE DEFINER=`root`@`localhost` PROCEDURE `GenDayPointDetailAndReport`(IN `collectDate` date)
BEGIN 
   
 declare vipNum int;
  declare drawReq decimal(11,2); 
  declare drawAmount decimal(11,2); 
  declare reAmount decimal(11,2); 
  declare reBeans int; 
  declare rePoint int;
   declare exchNum int;
   declare sendNum int;
   declare  hlgNum int;
   declare  hlgAmount decimal(11,2); 
   declare  hlgBeans int; 
   declare  actAmount decimal(11,2); 
   declare  actBeans int;
   declare  actPoint int;

     UPDATE M_DAY_POINT_DETAIL A,M_USER_INFO B SET  A.TEAM_MONEY = B.TEAM_MONEY, A.MY_MONEY = B.MY_MONEY,A.VERSION = A.VERSION+1
     WHERE A.USER_ID = B.ID AND A.COLLECT_DATE = collectDate;

	
     INSERT INTO M_DAY_POINT_DETAIL  (COLLECT_DATE, USER_ID, REWARD_AMOUNT, BEANS_NUM, POINT_AMOUNT, MANAGE_AMOUNT, COACH_AMOUNT, STATUS, VERSION, TEAM_MONEY, MY_MONEY) 
     SELECT  collectDate,A.ID, 0, 0, 0,0, 0,2,1, A.TEAM_MONEY, A.MY_MONEY
     FROM M_USER_INFO A LEFT JOIN M_DAY_POINT_DETAIL B ON A.ID = B.USER_ID  AND B.COLLECT_DATE = collectDate
     WHERE B.ID IS NULL;

     DELETE FROM M_DAY_REPORT WHERE COLLECT_DATE = collectDate;
	
     SELECT COUNT(1) into vipNum FROM M_USER_INFO WHERE DATE(ACTIVATE_TIME) = collectDate and IS_OPEND = 2 ;

     SELECT IFNULL(SUM(AMOUNT),0) into drawReq FROM M_DRAW WHERE DATE(CREATE_TIME) = collectDate;
     SELECT IFNULL(SUM(AMOUNT),0) into drawAmount FROM M_DRAW WHERE DATE(UPDATE_TIME) = collectDate and STATUS = 5;
     
     SELECT IFNULL(SUM(AMOUNT),0) into reAmount FROM M_RECHARGE WHERE DATE(CREATE_TIME) = collectDate and STATUS = 2 AND ACCOUNT_TYPE = 1;
     SELECT IFNULL(SUM(AMOUNT),0) into reBeans FROM M_RECHARGE WHERE DATE(CREATE_TIME) = collectDate and STATUS = 2 AND ACCOUNT_TYPE = 2;
     SELECT IFNULL(SUM(AMOUNT),0) into rePoint FROM M_RECHARGE WHERE DATE(CREATE_TIME) = collectDate and STATUS = 2 AND ACCOUNT_TYPE = 3;
	
     SELECT COUNT(1) into exchNum FROM M_EXCHANGE_INFO WHERE DATE(APPLY_TIME) = collectDate;
     SELECT COUNT(1) into sendNum FROM M_EXCHANGE_INFO WHERE DATE(SEND_TIME) = collectDate AND STATE = 2;

     SELECT COUNT(DISTINCT USER_ID) into hlgNum FROM M_USER_ACCOUNT_INOUT WHERE DATE(CREATE_TIME) = collectDate  AND USER_TYPE = 12;
     SELECT IFNULL(SUM(AMOUNT),0) into hlgAmount FROM M_USER_ACCOUNT_INOUT WHERE DATE(CREATE_TIME) = collectDate  AND  ACCOUNT_TYPE = 1 AND  USER_TYPE = 12;
     SELECT IFNULL(SUM(AMOUNT),0) into hlgBeans FROM M_USER_ACCOUNT_INOUT WHERE DATE(CREATE_TIME) = collectDate  AND   ACCOUNT_TYPE = 2 AND USER_TYPE = 12;


     
     SELECT IFNULL(SUM(AMOUNT),0) into actAmount FROM M_USER_ACCOUNT_INOUT WHERE DATE(CREATE_TIME) = collectDate  AND   INOUT_TYPE = 124;
     SELECT IFNULL(SUM(AMOUNT),0) into actBeans FROM M_USER_ACCOUNT_INOUT WHERE DATE(CREATE_TIME) = collectDate  AND   INOUT_TYPE = 224;
     SELECT IFNULL(SUM(AMOUNT),0) into actPoint FROM M_USER_ACCOUNT_INOUT WHERE DATE(CREATE_TIME) = collectDate  AND   INOUT_TYPE = 324;

     INSERT  INTO M_DAY_REPORT(COLLECT_DATE, REWARD_AMOUNT, BEANS_NUM, POINT_AMOUNT, MANAGE_AMOUNT, COACH_AMOUNT,VIP_NUM,DRAW_REQ,DRAW_AMOUNT,RECHARGE_AMOUNT,
     RECHARGE_BEANS,RECHARGE_POINT,EXCHANGE_NUM,SEND_NUM,HLG_NUM,HLG_AMOUNT,HLG_BEANS,ACT_USER_AMOUNT,ACT_USER_BEANS,ACT_USER_POINT, VERSION)
     SELECT COLLECT_DATE, SUM(REWARD_AMOUNT) , SUM(BEANS_NUM) , SUM(POINT_AMOUNT) ,
     SUM(MANAGE_AMOUNT) , SUM(COACH_AMOUNT) ,vipNum,drawReq,drawAmount,reAmount,reBeans,rePoint,exchNum,sendNum,hlgNum,hlgAmount,hlgBeans,actAmount,actBeans,actPoint, 1
     FROM M_DAY_POINT_DETAIL WHERE COLLECT_DATE = collectDate GROUP BY COLLECT_DATE;

     

	     
END






数据调整
UPDATE M_STAR_NODE SET PARENT_STR = REPLACE(PARENT_STR,'2,5,15,33,8165,10536,10537,10548,10606,11452','11881,11914,11925,12054,12055,12066,12068,12079,12191,11452')
,FLOORS = 20
  WHERE PARENT_STR like '%11452%' and FLOORS = 11;